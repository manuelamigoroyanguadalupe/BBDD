/* CREAR BASE DE DATOS*/
CREATE DATABASE Potencia_Digital_2;
go
USE Potencia_Digital_2;
go

/* TABLA CHARLAS */
CREATE TABLE Charlas (
  Id_charla SMALLINT IDENTITY(1,1) PRIMARY KEY, /*Identificador único de la charla*/
  Nombre_Eventos VARCHAR(255) NOT NULL, /*Nombre del evento o charla*/
  Informacion_adicional VARCHAR(MAX) NULL /*Informacion_adicional que se quiera añadir (no obligatorio por eso es NULL)*/
);

/* TABLA FECHAS */
CREATE TABLE Fechas (
  Fecha DATE PRIMARY KEY /* Tiene que ser primary key ya que más abajo necesitaremos hacer unn foreing key ha este campo*/
);


/* TABLA FECHAS_CHARLAS */
CREATE TABLE Fechas_Charlas (
  Id_charla SMALLINT NOT NULL,
  Fecha DATE NOT NULL, /*Fecha en la que se realiza la charla*/
  Hora TIME NOT NULL,

  PRIMARY KEY (Id_charla, Fecha, Hora), /*Necesitamos que sea clave compuesta*/

  FOREIGN KEY (Id_charla) REFERENCES Charlas(Id_charla), /*Para que a la hora de añadir charlas, solo se puedan añadir las que existan en la tabla Charla(idCharla)*/
  FOREIGN KEY (Fecha) REFERENCES Fechas(Fecha)/*Para que a la hora de añadir fechas, solo se puedan añadir las que existan en la tabla Fecha*/
);


/* TABLA USUARIO */
CREATE TABLE Usuario (
  Id_usuario INT IDENTITY(1,1) PRIMARY KEY,/*Identificador único del usuario. Unos 30.000 usuarios máximo*/
  Nombre VARCHAR(100) NOT NULL, /*Nombre del usuario*/
  N_Telefono CHAR(13) NOT NULL UNIQUE /* Número de teléfono del usuario. Con prefijo (3+9 o 10 digitos)*/
);

/* TABLA PONENTE  */
CREATE TABLE Ponente (
  Id_ponente TINYINT IDENTITY(1,1) PRIMARY KEY, /*Identificador del ponente*/
  Nombre VARCHAR(50) NOT NULL, /*Nombre del ponente*/
  Apellido VARCHAR(50) NOT NULL /*Apellidos del ponente*/
);


/* TABLA CHARLA_PONENTE */
CREATE TABLE Charla_Ponente (
  Id_charla SMALLINT NOT NULL,
  Id_ponente TINYINT NOT NULL,

  PRIMARY KEY (Id_charla, Id_ponente),

  FOREIGN KEY (Id_charla) REFERENCES Charlas(Id_charla),
  FOREIGN KEY (Id_ponente) REFERENCES Ponente(Id_ponente)
);


/* TABLA VALORACION_USUARIO */
CREATE TABLE Valoracion_Usuario (
  Id_usuario INT NOT NULL,
  Id_charla SMALLINT NOT NULL,
  Valoracion DECIMAL(4,2) NOT NULL,

  PRIMARY KEY (Id_usuario, Id_charla),

  FOREIGN KEY (Id_usuario) REFERENCES Usuario(Id_usuario),
  FOREIGN KEY (Id_charla) REFERENCES Charlas(Id_charla)
);

/* TABLA COSTE_PONENTE */
CREATE TABLE Coste_Ponente (
  Id_ponente TINYINT NOT NULL,
  Id_charla SMALLINT NOT NULL,
  Costo_charla SMALLMONEY NULL,

  PRIMARY KEY (Id_ponente, Id_charla),

  FOREIGN KEY (Id_ponente) REFERENCES Ponente(Id_ponente),
  FOREIGN KEY (Id_charla) REFERENCES Charlas(Id_charla),

  CHECK (Costo_charla > 0)
);

/*TABLA COLEGIOS*/
CREATE TABLE colegios (
  idColegio INT NOT NULL PRIMARY KEY, /*Pongo smallint pensando en que esta base de datos se va a reutilizar en un futuro y pasarán de los 255 institutos inscritos*/
  nombre VARCHAR (40) NOT NULL, /*Nombre del instituto*/
  persona_contacto CHAR (15) NOT NULL, /*Nombre del contacto*/
  tfno_contacto CHAR (13) NULL /*N_telefono de contacto con el instituto*/

),

/*TABLA COLEGIOS_ACTIVIDADES*/
CREATE TABLE colegios_actividades(

  idReserva INT IDENTITY(1,1) PRIMARY KEY,
  idColegio INT NOT NULL DEFAULT 0,
  idCharla SMALLINT NULL,
  fecha DATE NOT NULL,
  numero_asistentes SMALLINT NOT NULL,

FOREIGN KEY (idColegio) REFERENCES colegios( idColegio ) ON DELETE CASCADE,
FOREIGN KEY (idCharla) REFERENCES Charlas( Id_charla ) ON DELETE NO ACTION,
FOREIGN KEY (fecha) REFERENCES fechas(fecha)
);


/*INSERTAR FILAS*/

/* COLEGIOS */
INSERT INTO colegios VALUES (0, 'plazas disponibles', 'no procede', 'no procede');
INSERT INTO colegios VALUES (1, 'IES Cervantes', 'Juan Pérez', '600123456');
INSERT INTO colegios VALUES (2, 'Colegio San José', 'María López', '611987654');

/* FECHAS */
INSERT INTO Fechas (Fecha)
VALUES ('2026-03-10'), ('2026-04-05');

/* CHARLAS */
INSERT INTO Charlas (Nombre_Eventos, Informacion_adicional)
VALUES 
  ('Ciberseguridad', 'Charla sobre seguridad digital'),
  ('IA en educación', 'Uso de IA en aulas');

/* COLEGIOS_ACTIVIDADES */
INSERT INTO colegios_actividades (idColegio, idCharla, fecha, numero_asistentes)
VALUES (1, 1, '2026-03-10', 45);

INSERT INTO colegios_actividades (idColegio, idCharla, fecha, numero_asistentes)
VALUES (2, 2, '2026-04-05', 30);

INSERT INTO colegios_actividades (idColegio, idCharla, fecha, numero_asistentes)
VALUES (0, 1, '2026-03-10', 20);
